<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Stellar Pastes — Master (No QR)</title>
<style>
:root{
  --bg:#04061a;
  --muted:#9aa4b2;
  --light-blue: rgba(200,230,255,0.08);
  --light-blue-strong: rgba(180,215,255,0.14);
  --glass-border: rgba(160,190,230,0.10);
  --accent:#7c3aed;
}
html,body{height:100%;margin:0;background:var(--bg);font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;color:#eaf6ff;overflow-x:hidden}
#starfield{position:fixed;inset:0;z-index:0}

/* Intro overlay */
#introOverlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:9999;background:radial-gradient(circle at center,rgba(0,0,0,0.6),rgba(0,0,0,0.9));transition:opacity .9s ease}
#introOverlay.hidden{opacity:0;pointer-events:none}
.intro-title{font-size:64px;font-weight:900;background:linear-gradient(90deg,#7c3aed,#06b6d4,#7c3aed);-webkit-background-clip:text;color:transparent;text-shadow:0 0 30px rgba(124,58,237,0.45);animation:pulse 2s infinite}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.04)}100%{transform:scale(1)}}

/* App layout */
.app-wrap{position:relative;z-index:2;min-height:100vh;display:none;opacity:0;transition:opacity .8s ease}
.header{max-width:1200px;margin:20px auto;padding:12px 18px;display:flex;justify-content:space-between;align-items:center}
.header h1{font-size:34px;margin:0;font-weight:900;background:linear-gradient(90deg,#7c3aed,#06b6d4,#7c3aed);-webkit-background-clip:text;color:transparent;text-shadow:0 0 30px rgba(124,58,237,0.6);animation:pulse 3s infinite}
.container{max-width:1200px;margin:12px auto 40px;display:grid;grid-template-columns:65% 35%;gap:22px;padding:18px}

/* Cards */
.card{background:linear-gradient(180deg, var(--light-blue), var(--light-blue-strong));backdrop-filter:blur(8px);border-radius:14px;padding:16px;border:1px solid var(--glass-border);box-shadow:0 10px 30px rgba(6,20,50,0.6)}

/* Embedded editor box */
.editor-box{background:linear-gradient(180deg,var(--light-blue),var(--light-blue-strong));border:1px solid rgba(150,190,240,0.12);border-radius:12px;overflow:hidden;margin-bottom:12px}
.editor-box input{width:100%;padding:12px;border:none;border-bottom:1px solid rgba(150,190,240,0.18);background:transparent;color:#fff;font-weight:700}
.editor-box textarea{width:100%;min-height:340px;padding:12px;border:none;resize:vertical;background:transparent;color:#eaf6ff;font-family:ui-monospace,Menlo,monospace}

/* Language dropdown (black text) */
.editor select{color:#000;background:#eaf6ff;padding:8px;border-radius:8px}

/* Controls */
.center-controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;justify-content:center;margin-top:12px}
.input-url{padding:10px;border-radius:10px;border:1px solid rgba(150,190,240,0.12);background:rgba(220,240,255,0.06);color:#eaf6ff;min-width:260px}
.expiry-badge{padding:6px 10px;border-radius:12px;background:linear-gradient(90deg,var(--accent),#06b6d4);font-weight:700;color:#fff;box-shadow:0 8px 22px rgba(124,58,237,0.12)}

/* Sidebar */
.side{display:flex;flex-direction:column;gap:14px;height:calc(100vh - 200px)}
.saved-list{flex:1;overflow:auto;padding-right:6px}
.paste-item{padding:10px;border-radius:10px;background:rgba(220,240,255,0.03);margin-bottom:8px;cursor:pointer;display:flex;justify-content:space-between;align-items:center}
.controls-vertical{display:flex;flex-direction:column;gap:10px;margin-top:12px}

/* Buttons */
.btn{border:0;padding:10px 14px;border-radius:999px;font-weight:700;cursor:pointer;color:#fff;transition:transform .12s,box-shadow .12s}
.btn:hover{transform:scale(1.04)}
.btn-green{background:linear-gradient(90deg,#22c55e,#16a34a)}
.btn-blue{background:linear-gradient(90deg,#3b82f6,#2563eb)}
.btn-red{background:linear-gradient(90deg,#ef4444,#dc2626)}
.btn-purple{background:linear-gradient(90deg,#8b5cf6,#7c3aed)}
.btn-cyan{background:linear-gradient(90deg,#06b6d4,#0891b2)}
.btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}

/* VK */
.vk-panel{margin-top:12px;background:rgba(220,240,255,0.03);padding:12px;border-radius:10px}
.vk-keys{display:flex;flex-wrap:wrap;gap:8px}
.vk-keys button{padding:8px 12px;border-radius:8px;border:1px solid rgba(150,190,240,0.08);background:rgba(255,255,255,0.03);color:#eaf6ff;cursor:pointer}

/* Modal */
.modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:min(960px,96%);background:linear-gradient(180deg, rgba(12,13,28,0.96), rgba(10,11,22,0.99));border-radius:14px;padding:18px;display:none;z-index:10000;max-height:90vh;overflow:auto;border:1px solid rgba(255,255,255,0.03)}
.modal.open{display:block}
.meta{color:var(--muted);font-size:13px;margin-top:6px}
.actions{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
.thank-you{font-weight:900;font-size:20px;background:linear-gradient(90deg,#fff,#fffb86,#a3e0ff);-webkit-background-clip:text;color:transparent;text-shadow:0 0 18px rgba(163,224,255,0.25);padding:18px;border-radius:12px;text-align:center;width:100%}

/* About cards */
.team-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;margin-top:12px}
.team-card{position:relative;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:16px;border:1px solid rgba(255,255,255,0.03);overflow:hidden;box-shadow:0 8px 24px rgba(2,8,23,0.6);transition:transform .18s ease,box-shadow .18s ease}
.team-card:hover{transform:translateY(-8px);box-shadow:0 18px 40px rgba(2,8,23,0.75)}
.avatar{width:64px;height:64px;border-radius:12px;display:inline-flex;align-items:center;justify-content:center;font-weight:800;font-size:20px;color:#061226;background:linear-gradient(135deg,rgba(255,255,255,0.96),rgba(230,240,255,0.96));box-shadow:inset 0 -6px 14px rgba(0,0,0,0.05)}
.team-card h4{margin:0;font-size:16px}
.team-card p.role{margin:6px 0 0 0;color:var(--muted);font-size:13px}
.team-card p.bio{margin:10px 0 0 0;color:#dfeefe;font-size:13px;line-height:1.25}
.accent-band{position:absolute;right:-40px;top:-48px;width:140px;height:140px;border-radius:50%;filter:blur(28px);opacity:0.18;transform:rotate(20deg)}

/* responsive */
@media (max-width:900px){ .container{grid-template-columns:1fr;padding:12px} .editor-box textarea{min-height:260px} }
</style>
</head>
<body>

<canvas id="starfield"></canvas>

<!-- Cover -->
<div id="introOverlay"><div class="intro-title">STELLAR PASTES</div></div>

<!-- App -->
<div class="app-wrap">
  <header class="header">
    <h1>Stellar Pastes</h1>
    <div style="display:flex;gap:12px;align-items:center">
      <div id="cloudBadge" style="padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02);font-weight:700;font-size:13px">Cloud Ready</div>
      <button id="aboutUsBtn" class="btn btn-purple">About Us</button>
    </div>
  </header>

  <main class="container">
    <!-- Editor -->
    <section class="card editor">
      <div class="editor-box">
        <input id="title" placeholder="Title (optional)" />
        <textarea id="content" placeholder="Paste or type content here..."></textarea>
      </div>

      <div style="display:flex;gap:10px;align-items:center;margin-bottom:8px">
        <select id="language" style="flex:1">
          <option value="english">English</option>
          <option value="hindi">हिन्दी</option>
          <option value="bengali">বাংলা</option>
          <option value="tamil">தமிழ்</option>
          <option value="telugu">తెలుగు</option>
          <option value="marathi">मराठी</option>
        </select>
        <button id="vkToggleBtn" class="btn btn-purple">Enable VK</button>
      </div>

      <div class="center-controls">
        <button id="generateUrlBtn" class="btn btn-purple">Generate URL</button>

        <div class="expiry-wrap" style="display:flex;flex-direction:column;align-items:center">
          <button id="setExpiryBtn" class="btn btn-ghost">Set Expiry</button>
          <input id="expiryPicker" type="date" style="display:none;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:rgba(255,255,255,0.02);color:#eaf6ff" />
          <div id="expiryLabel" class="meta">No expiry</div>
        </div>

        <div style="display:flex;align-items:center;gap:8px">
          <input id="generatedUrl" class="input-url" readonly style="display:none" />
          <div id="generatedExpiry" style="display:none" class="expiry-badge"></div>
          <button id="copyUrlBtn" class="btn btn-cyan" style="display:none">Copy URL</button>
        </div>
      </div>

      <div id="vkPanel" class="vk-panel" style="display:none"></div>
    </section>

    <!-- Sidebar -->
    <aside class="card side">
      <h3 style="margin-top:0">Saved Texts</h3>
      <div id="pasteList" class="saved-list"></div>

      <div class="controls-vertical">
        <button id="saveTextBtn" class="btn btn-green">Save</button>
        <button id="refreshBtn" class="btn btn-blue">Refresh</button>
        <button id="resetBtn" class="btn btn-red">Reset</button>
      </div>
    </aside>
  </main>
</div>

<!-- Result Modal -->
<div id="resultModal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <div style="flex:1">
      <h2 id="resTitle" style="margin:0">Paste</h2>
      <div id="resExpiryBadge" style="margin-top:8px;display:none" class="expiry-badge"></div>
      <div id="resMeta" class="meta" style="margin-top:10px"></div>
    </div>
    <div style="display:flex;gap:8px;align-items:center">
      <button id="resCopyBtn" class="btn btn-cyan">Copy URL</button>
      <button id="resShareBtn" class="btn btn-blue">Share</button>
    </div>
  </div>

  <pre id="resContent" style="white-space:pre-wrap;background:rgba(2,6,23,0.6);padding:12px;border-radius:8px;margin-top:12px;color:#eaf6ff;max-height:38vh;overflow:auto"></pre>

  <div class="actions">
    <button id="resWhatsBtn" class="btn btn-green">WhatsApp</button>
    <button id="resTeleBtn" class="btn btn-blue">Telegram</button>
    <button id="resEditBtn" class="btn btn-ghost">Edit</button>
    <button id="resDeleteBtn" class="btn btn-ghost" style="color:#ffb4b4">Delete</button>
  </div>

  <!-- REPLACED QR AREA: glowing THANK YOU message -->
  <div style="margin-top:12px" class="meta">Below is a message from Stellar Pastes</div>
  <div id="thankYouArea" style="margin-top:10px;display:flex;justify-content:center;align-items:center">
    <div class="thank-you">THANK YOU FOR USING STELLAR PASTES</div>
  </div>
</div>

<!-- About Modal (clean cards: no social icons) -->
<div id="aboutModal" class="modal" style="width:720px;display:none">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <div>
      <h3 style="margin:0">About Us</h3>
      <div class="meta" style="margin-top:6px">Built by the Stellar Codes team — crafted with constellations and care.</div>
    </div>
    <div style="text-align:right"><button id="aboutClose" class="btn btn-ghost">Close</button></div>
  </div>

  <div class="team-grid">
    <div class="team-card">
      <div class="accent-band" style="background:linear-gradient(135deg,#8b5cf6,#7c3aed);"></div>
      <div style="display:flex;gap:12px;align-items:center">
        <div class="avatar">SN</div>
        <div>
          <h4>SHREYANJAN NEOGI</h4>
          <p class="role">Frontend Engineer</p>
        </div>
      </div>
      <p class="bio">Design-focused frontend engineer. Shapes interfaces, micro-interactions, and the starry UI you see here.</p>
    </div>

    <div class="team-card">
      <div class="accent-band" style="background:linear-gradient(135deg,#ec4899,#db2777);"></div>
      <div style="display:flex;gap:12px;align-items:center">
        <div class="avatar">SS</div>
        <div>
          <h4>SHRISHTI SHARAN</h4>
          <p class="role">Designer</p>
        </div>
      </div>
      <p class="bio">Visual & brand designer. Responsible for the Lucid icons, glassy layouts, and the interface polish.</p>
    </div>

    <div class="team-card">
      <div class="accent-band" style="background:linear-gradient(135deg,#3b82f6,#2563eb);"></div>
      <div style="display:flex;gap:12px;align-items:center">
        <div class="avatar">SM</div>
        <div>
          <h4>SWAPNIL MAJUMDAR</h4>
          <p class="role">Backend / DevOps</p>
        </div>
      </div>
      <p class="bio">Keeps the cloud humming. Manages deployments, simulated cloud hooks, and makes the infra resilient.</p>
    </div>

    <div class="team-card">
      <div class="accent-band" style="background:linear-gradient(135deg,#22c55e,#16a34a);"></div>
      <div style="display:flex;gap:12px;align-items:center">
        <div class="avatar">SS</div>
        <div>
          <h4>SAURABH S SINGH</h4>
          <p class="role">Product</p>
        </div>
      </div>
      <p class="bio">Product lead focused on UX, scope and stellar quality. Connects design and engineering with empathy.</p>
    </div>

  </div>
</div>

<script>
/* ===============================
   Cover overlay hide
   - fade after 3s or on any key/click
=============================== */
function hideIntro(){
  const i = document.getElementById('introOverlay');
  if(!i || i.classList.contains('hidden')) return;
  i.classList.add('hidden');
  setTimeout(()=>{ i.style.display='none'; const a=document.querySelector('.app-wrap'); if(a){ a.style.display='block'; setTimeout(()=>a.style.opacity=1,60);} },900);
}
setTimeout(hideIntro,3000);
document.addEventListener('keydown', hideIntro);
document.addEventListener('click', hideIntro);

/* ===============================
   Starfield + constellations
=============================== */
const canvas = document.getElementById('starfield');
const ctx = canvas.getContext('2d');
let W = canvas.width = innerWidth;
let H = canvas.height = innerHeight;
addEventListener('resize', ()=>{ W = canvas.width = innerWidth; H = canvas.height = innerHeight; });
const STARS = Array.from({length:120}, ()=>({ x: Math.random()*W, y: Math.random()*H, r: Math.random()*1.6+0.2, vx:(Math.random()-0.5)*0.3, vy:(Math.random()-0.5)*0.3, tw: Math.random()*Math.PI*2 }));
let glow = 0, gdir = 1;
function renderStars(){
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,'#020218'); g.addColorStop(1,'#000012');
  ctx.fillStyle = g; ctx.fillRect(0,0,W,H);
  for(const s of STARS){ s.x += s.vx; s.y += s.vy; s.tw += 0.02; if(s.x < -10) s.x = W+10; if(s.x > W+10) s.x = -10; if(s.y < -10) s.y = H+10; if(s.y > H+10) s.y = -10; const t = 0.5 + 0.5*Math.abs(Math.sin(s.tw)); ctx.beginPath(); ctx.fillStyle = 'rgba(255,255,255,' + (0.6*t) + ')'; ctx.arc(s.x,s.y,s.r*t,0,Math.PI*2); ctx.fill(); }
  glow += gdir*0.008; if(glow>0.35||glow<0.03) gdir*=-1;
  ctx.strokeStyle = `rgba(200,220,255,${glow*0.8})`; ctx.lineWidth = 0.5;
  for(let i=0;i<STARS.length;i++){ for(let j=i+1;j<STARS.length;j++){ const a=STARS[i], b=STARS[j]; const dx=a.x-b.x, dy=a.y-b.y; const d=Math.sqrt(dx*dx+dy*dy); if(d<120){ ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke(); } } }
  // simple constellations
  ctx.save(); ctx.shadowBlur = 18; ctx.globalCompositeOperation = 'lighter';
  const consts = [
    {name:'Orion', color:'rgba(180,200,255,0.9)', pts:[[0.45,0.35],[0.5,0.45],[0.55,0.5],[0.5,0.55],[0.45,0.6],[0.4,0.5]]},
    {name:'Cassiopeia', color:'rgba(255,220,200,0.9)', pts:[[0.14,0.16],[0.2,0.19],[0.26,0.15],[0.32,0.2],[0.38,0.16]]}
  ];
  for(const c of consts){
    ctx.strokeStyle = c.color; ctx.lineWidth = 1.2; ctx.beginPath();
    c.pts.forEach((p,i)=>{ const x=p[0]*W, y=p[1]*H; if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); });
    ctx.stroke();
    c.pts.forEach((p,idx)=>{ const x=p[0]*W, y=p[1]*H; ctx.beginPath(); ctx.fillStyle='rgba(255,255,255,0.95)'; ctx.arc(x,y,2.8+(idx===2?1:0),0,Math.PI*2); ctx.fill(); ctx.globalAlpha=0.12; ctx.fillStyle=c.color; ctx.beginPath(); ctx.arc(x,y,10,0,Math.PI*2); ctx.fill(); ctx.globalAlpha=1; });
    ctx.fillStyle = c.color; ctx.font='12px Inter,system-ui'; ctx.fillText(c.name, c.pts[0][0]*W+8, c.pts[0][1]*H-8);
  }
  ctx.restore();
  requestAnimationFrame(renderStars);
}
renderStars();

/* ===============================
   Cloud localStorage simulation
=============================== */
const CLOUD_PREFIX = 'stellar_cloud_';
async function saveToCloud(paste){ localStorage.setItem(CLOUD_PREFIX + paste.id, JSON.stringify(paste)); return paste.id; }
async function loadFromCloud(id){ const raw=localStorage.getItem(CLOUD_PREFIX + id); return raw ? JSON.parse(raw) : null; }
async function deleteFromCloud(id){ localStorage.removeItem(CLOUD_PREFIX + id); return true; }
async function listCloudPastes(){ const out=[]; for(let i=0;i<localStorage.length;i++){ const k=localStorage.key(i); if(k && k.startsWith(CLOUD_PREFIX)) try{ out.push(JSON.parse(localStorage.getItem(k))); }catch(e){} } out.sort((a,b)=> (b.createdAt||0)-(a.createdAt||0)); return out; }

/* ===============================
   Helpers
=============================== */
function genId(){ return Date.now().toString(36) + Math.random().toString(36).slice(2,7); }
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[c])); }
function toast(msg){
  const t = document.createElement('div'); t.textContent = msg;
  t.style.position='fixed'; t.style.bottom='22px'; t.style.left='50%'; t.style.transform='translateX(-50%)';
  t.style.background='rgba(0,0,0,0.7)'; t.style.color='#fff'; t.style.padding='10px 14px'; t.style.borderRadius='10px'; t.style.zIndex=20000;
  document.body.appendChild(t); setTimeout(()=> t.style.opacity='0', 1600); setTimeout(()=> t.remove(), 2100);
}

/* ===============================
   UI wiring (kept intact) — QR removed, thank-you message used instead
=============================== */
document.addEventListener('DOMContentLoaded', async ()=>{
  // elements
  const titleEl = document.getElementById('title');
  const contentEl = document.getElementById('content');
  const langEl = document.getElementById('language');
  const vkToggleBtn = document.getElementById('vkToggleBtn');
  const vkPanel = document.getElementById('vkPanel');

  const generateBtn = document.getElementById('generateUrlBtn');
  const generatedUrl = document.getElementById('generatedUrl');
  const generatedExpiry = document.getElementById('generatedExpiry');
  const copyUrlBtn = document.getElementById('copyUrlBtn');

  const setExpiryBtn = document.getElementById('setExpiryBtn');
  const expiryPicker = document.getElementById('expiryPicker');
  const expiryLabel = document.getElementById('expiryLabel');

  const saveBtn = document.getElementById('saveTextBtn');
  const refreshBtn = document.getElementById('refreshBtn');
  const resetBtn = document.getElementById('resetBtn');
  const pasteList = document.getElementById('pasteList');

  const resultModal = document.getElementById('resultModal');
  const resTitle = document.getElementById('resTitle');
  const resMeta = document.getElementById('resMeta');
  const resContent = document.getElementById('resContent');
  const resExpiryBadge = document.getElementById('resExpiryBadge');
  const thankYouArea = document.getElementById('thankYouArea');

  const resCopyBtn = document.getElementById('resCopyBtn');
  const resShareBtn = document.getElementById('resShareBtn');
  const resWhatsBtn = document.getElementById('resWhatsBtn');
  const resTeleBtn = document.getElementById('resTeleBtn');
  const resEditBtn = document.getElementById('resEditBtn');
  const resDeleteBtn = document.getElementById('resDeleteBtn');

  const aboutBtn = document.getElementById('aboutUsBtn');
  const aboutModal = document.getElementById('aboutModal');
  const aboutClose = document.getElementById('aboutClose');

  // state
  let copyActive = false;
  function setCopyActive(v){
    copyActive = !!v;
    if(copyActive){ copyUrlBtn.textContent = 'STELLARLY COPIED!'; copyUrlBtn.disabled = true; }
    else { copyUrlBtn.textContent = 'Copy URL'; copyUrlBtn.disabled = false; }
  }
  function resetCopyState(){ if(copyActive) setCopyActive(false); }

  // render saved list
  async function renderList(){
    const arr = await listCloudPastes();
    pasteList.innerHTML = '';
    if(!arr.length){ pasteList.innerHTML = '<div class="meta">No saved texts yet</div>'; return; }
    arr.forEach(item=>{
      const el = document.createElement('div'); el.className = 'paste-item';
      const left = document.createElement('div'); left.style.flex='1';
      left.innerHTML = `<strong>${escapeHtml(item.title || '(no title)')}</strong><div class="meta">${escapeHtml(item.language)} • ${new Date(item.createdAt).toLocaleString()}</div>`;
      const right = document.createElement('div'); right.style.display='flex'; right.style.gap='8px';
      const openBtn = document.createElement('button'); openBtn.className='btn btn-blue'; openBtn.textContent='Open';
      openBtn.onclick = ()=>{ location.hash = '#p=' + encodeURIComponent(item.id); openResult(item.id); };
      const delBtn = document.createElement('button'); delBtn.className='btn btn-ghost'; delBtn.textContent='Delete';
      delBtn.onclick = async ()=>{ if(confirm('Delete this saved paste?')){ await deleteFromCloud(item.id); await renderList(); toast('Deleted'); } };
      right.appendChild(openBtn); right.appendChild(delBtn);
      el.appendChild(left); el.appendChild(right);
      pasteList.appendChild(el);
    });
  }
  await renderList();

  // VK layouts & rendering
  const VK_LAYOUTS = {
    english: [['q','w','e','r','t','y','u','i','o','p'],['a','s','d','f','g','h','j','k','l'],['z','x','c','v','b','n','m'],['Space','Enter','Backspace']],
    hindi: [['क','ख','ग','घ','ङ','च','छ','ज','झ','ञ'],['ट','ठ','ड','ढ','ण','त','थ','द','ध'],['न','प','फ','ब','भ','म','य'],['Space','Enter','Backspace']],
    bengali: [['ক','খ','গ','ঘ','ঙ','চ','ছ','জ','ঝ','ঞ'],['ট','ঠ','ড','ঢ','ণ','ত','থ','দ','ধ'],['ন','প','ফ','ব','ভ','ম','য'],['Space','Enter','Backspace']],
    tamil: [['க','ங','ச','ஞ','ட','ண','த','ந','ப','ம'],['ய','ர','ல','ள','வ','ழ','ற','ன'],['அ','ஆ','இ','ஈ','உ','ஊ','எ'],['Space','Enter','Backspace']],
    telugu: [['క','ఖ','గ','ఘ','ఙ','చ','ఛ','జ','ఝ','ఞ'],['ట','ఠ','డ','ఢ','ణ','త','థ','ద','ధ'],['న','ప','ఫ','బ','భ','మ','య'],['Space','Enter','Backspace']],
    marathi: [['क','ख','ग','घ','ङ','च','छ','ज','झ','ञ'],['ट','ठ','ड','ढ','ण','त','थ','द','ध'],['न','प','फ','ब','भ','म','य'],['Space','Enter','Backspace']]
  };
  function renderVK(){
    const panel = vkPanel;
    const lang = langEl.value;
    const layout = VK_LAYOUTS[lang] || VK_LAYOUTS.english;
    panel.innerHTML = '<div class="vk-keys" id="vkKeys"></div>';
    const wrap = document.getElementById('vkKeys');
    layout.forEach(row=>{
      const rowDiv = document.createElement('div');
      row.forEach(k=>{
        const b = document.createElement('button'); b.type='button'; b.textContent = (k==='Space')? '␣' : k;
        b.style.minWidth = (k==='Space') ? '220px' : '48px';
        b.onclick = ()=> vkKey(k);
        rowDiv.appendChild(b);
      });
      wrap.appendChild(rowDiv);
    });
  }
  function vkKey(k){
    const ta = contentEl; if(!ta) return;
    const start = ta.selectionStart || 0, end = ta.selectionEnd || 0;
    if(k==='Backspace'){ if(start===end && start>0){ ta.value = ta.value.slice(0,start-1) + ta.value.slice(end); ta.selectionStart=ta.selectionEnd = start-1; } else { ta.value = ta.value.slice(0,start) + ta.value.slice(end); ta.selectionStart=ta.selectionEnd = start; } ta.focus(); return; }
    const ins = (k==='Enter')?'\n':(k==='Space'?' ':k);
    ta.value = ta.value.slice(0,start) + ins + ta.value.slice(end);
    ta.selectionStart = ta.selectionEnd = start + ins.length;
    ta.focus(); resetCopyState();
  }
  let vkOn = false;
  vkToggleBtn.onclick = ()=>{ vkOn = !vkOn; if(vkOn){ vkToggleBtn.textContent='Disable VK'; vkPanel.style.display='block'; renderVK(); } else { vkToggleBtn.textContent='Enable VK'; vkPanel.style.display='none'; } };
  langEl.onchange = ()=>{ if(vkOn) renderVK(); resetCopyState(); };

  // expiry UI wiring
  setExpiryBtn.onclick = ()=>{ expiryPicker.style.display = expiryPicker.style.display === 'inline-block' ? 'none' : 'inline-block'; if(expiryPicker.style.display === 'inline-block') expiryPicker.focus(); };
  expiryPicker.onchange = function(){
    expiryLabel.textContent = this.value ? 'Expires: ' + new Date(this.value).toLocaleDateString() : 'No expiry';
    if(generatedUrl && generatedUrl.value){
      if(this.value){ generatedExpiry.style.display='inline-block'; generatedExpiry.textContent = 'Expires: ' + new Date(this.value).toLocaleDateString(); } else { generatedExpiry.style.display='none'; generatedExpiry.textContent=''; }
    }
  };

  // Save / Refresh / Reset
  saveBtn.onclick = async ()=>{
    const content = contentEl.value || '';
    if(!content.trim()) return toast('Nothing to save');
    const paste = { id: genId(), title: titleEl.value.trim(), content, language: langEl.value, expiryDate: expiryPicker.value || null, createdAt: Date.now() };
    await saveToCloud(paste);
    await renderList();
    toast('Saved to cloud (simulated)');
  };
  refreshBtn.onclick = renderList;
  resetBtn.onclick = ()=>{ if(!confirm('Reset editor and generated URL?')) return; titleEl.value=''; contentEl.value=''; generatedUrl.style.display='none'; generatedUrl.value=''; generatedExpiry.style.display='none'; generatedExpiry.textContent=''; copyUrlBtn.style.display='none'; setCopyActive(false); expiryPicker.value=''; expiryLabel.textContent='No expiry'; toast('Reset'); };

  // GENERATE: save + show url and expiry in center (does NOT open modal)
  generateBtn.onclick = async ()=>{
    const content = contentEl.value || '';
    if(!content.trim()) return toast('Paste something first');
    const paste = { id: genId(), title: titleEl.value.trim(), content, language: langEl.value, expiryDate: expiryPicker.value || null, createdAt: Date.now() };
    await saveToCloud(paste);
    await renderList();
    const base = location.href.split('?')[0].split('#')[0];
    const pasteUrl = base + '#p=' + encodeURIComponent(paste.id);
    generatedUrl.style.display='inline-block'; generatedUrl.value = pasteUrl;
    copyUrlBtn.style.display='inline-block'; setCopyActive(false);
    if(paste.expiryDate){ generatedExpiry.style.display='inline-block'; generatedExpiry.textContent = 'Expires: ' + new Date(paste.expiryDate).toLocaleDateString(); } else { generatedExpiry.style.display='none'; generatedExpiry.textContent=''; }
    toast('URL generated (modal opens only on paste).');
  };

  // copy center url
  copyUrlBtn.onclick = ()=>{ const url = generatedUrl.value || ''; if(!url) return; navigator.clipboard.writeText(url).then(()=>{ setCopyActive(true); toast('STELLARLY COPIED!'); }, ()=> toast('Copy failed')); };

  // PASTE handler -> open modal (only when paste event occurs)
  contentEl.addEventListener('paste', (e)=>{
    setTimeout(async ()=>{
      const pastedContent = contentEl.value || '';
      if(!pastedContent.trim()) return;
      setCopyActive(false);
      const paste = { id: genId(), title: titleEl.value.trim(), content: pastedContent, language: langEl.value, expiryDate: expiryPicker.value || null, createdAt: Date.now() };
      await saveToCloud(paste);
      await renderList();
      const base = location.href.split('?')[0].split('#')[0];
      const pasteUrl = base + '#p=' + encodeURIComponent(paste.id);
      generatedUrl.style.display='inline-block'; generatedUrl.value = pasteUrl; copyUrlBtn.style.display='inline-block';
      if(paste.expiryDate){ generatedExpiry.style.display='inline-block'; generatedExpiry.textContent = 'Expires: ' + new Date(paste.expiryDate).toLocaleDateString(); } else { generatedExpiry.style.display='none'; generatedExpiry.textContent=''; }
      await openResult(paste.id);
    }, 60);
  });

  // openResult (modal) — loads from localStorage and shows expiry badge
  async function openResult(id){
    const item = await loadFromCloud(id);
    if(!item){ toast('Paste not found'); return; }
    resTitle.textContent = item.title || '(no title)';
    // expiry badge: prominent when expiry set; show expired flag if past date
    if(item.expiryDate){
      const ex = new Date(item.expiryDate);
      const today = new Date(); today.setHours(0,0,0,0);
      if(ex < today){
        resExpiryBadge.style.display='inline-block';
        resExpiryBadge.textContent = 'Expired on ' + ex.toLocaleDateString();
        resExpiryBadge.style.opacity = '0.9';
      } else {
        resExpiryBadge.style.display='inline-block';
        resExpiryBadge.textContent = 'Expires: ' + ex.toLocaleDateString();
        resExpiryBadge.style.opacity = '1';
      }
    } else {
      resExpiryBadge.style.display='none';
      resExpiryBadge.textContent = '';
    }
    resMeta.textContent = `${item.language} • ${new Date(item.createdAt).toLocaleString()}`;
    resContent.textContent = item.content;

    // Replace QR area with THANK YOU message (no QR)
    if(thankYouArea){
      thankYouArea.innerHTML = '<div class="thank-you">THANK YOU FOR USING STELLAR PASTES</div>';
    }

    resultModal.classList.add('open');
    resultModal.dataset.currentId = item.id;
  }

  // modal actions
  resCopyBtn.onclick = ()=>{ const id = resultModal.dataset.currentId; if(!id) return; const base = location.href.split('?')[0].split('#')[0]; const url = base + '#p=' + encodeURIComponent(id); navigator.clipboard.writeText(url).then(()=> toast('Copied paste URL'), ()=> toast('Copy failed')); };
  resShareBtn.onclick = ()=>{ const id = resultModal.dataset.currentId; if(!id) return; const base = location.href.split('?')[0].split('#')[0]; const url = base + '#p=' + encodeURIComponent(id); const text = resContent.textContent || ''; if(navigator.share) navigator.share({ title: resTitle.textContent || 'Stellar Paste', text, url }).catch(()=>{}); else toast('Device share not supported'); };
  resWhatsBtn.onclick = ()=>{ const id = resultModal.dataset.currentId; if(!id) return; const base = location.href.split('?')[0].split('#')[0]; const url = base + '#p=' + encodeURIComponent(id); window.open('https://wa.me/?text=' + encodeURIComponent(url), '_blank'); };
  resTeleBtn.onclick = ()=>{ const id = resultModal.dataset.currentId; if(!id) return; const base = location.href.split('?')[0].split('#')[0]; const url = base + '#p=' + encodeURIComponent(id); window.open('https://t.me/share/url?url=' + encodeURIComponent(url), '_blank'); };
  resEditBtn.onclick = async ()=>{ const id = resultModal.dataset.currentId; if(!id) return; const p = await loadFromCloud(id); if(!p) return; titleEl.value = p.title || ''; contentEl.value = p.content || ''; langEl.value = p.language || 'english'; expiryPicker.value = p.expiryDate || ''; expiryLabel.textContent = p.expiryDate ? 'Expires: ' + new Date(p.expiryDate).toLocaleDateString() : 'No expiry'; if(p.expiryDate && generatedUrl.value) { generatedExpiry.style.display='inline-block'; generatedExpiry.textContent = 'Expires: ' + new Date(p.expiryDate).toLocaleDateString(); } else { generatedExpiry.style.display='none'; generatedExpiry.textContent=''; } resultModal.classList.remove('open'); };
  resDeleteBtn.onclick = async ()=>{ const id = resultModal.dataset.currentId; if(!id) return; if(!confirm('Delete this paste?')) return; await deleteFromCloud(id); await renderList(); resultModal.classList.remove('open'); toast('Deleted'); };

  // about modal wiring
  aboutBtn.onclick = ()=>{ aboutModal.style.display='block'; aboutModal.classList.add('open'); };
  aboutClose.onclick = ()=>{ aboutModal.classList.remove('open'); aboutModal.style.display='none'; };

  // open from hash (#p=<id>) on page load
  if(location.hash && location.hash.startsWith('#p=')){
    const id = decodeURIComponent(location.hash.slice(3));
    setTimeout(()=> openResult(id), 120);
  }

  // cloud notepad route (?cloud=1&text=...)
  function parseQuery(){ const out={}; const s = location.search.replace(/^\?/,''); if(!s) return out; s.split('&').forEach(pair=>{ const [k,v] = pair.split('='); out[decodeURIComponent(k)] = decodeURIComponent((v||'').replace(/\+/g,' ')); }); return out; }
  const params = parseQuery();
  if(params.cloud === '1'){
    const cloudModal = document.createElement('div');
    cloudModal.className = 'modal open'; cloudModal.style.width = '80%';
    cloudModal.innerHTML = '<h2>☁️ Cloud Notepad</h2><textarea id="cloudBox" style="width:100%;height:60vh;margin-top:12px;padding:12px;border-radius:8px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04);color:#eaf6ff"></textarea><div style="text-align:right;margin-top:12px"><button id="closeCloud" class="btn btn-ghost">Close</button></div>';
    document.body.appendChild(cloudModal);
    document.getElementById('cloudBox').value = params.text || '';
    document.getElementById('closeCloud').onclick = ()=> cloudModal.remove();
  }

  // close modals on Esc
  document.addEventListener('keydown', e=>{ if(e.key==='Escape') document.querySelectorAll('.modal.open').forEach(m=>m.classList.remove('open')); });

  // click outside result modal closes it
  window.addEventListener('click', e=>{ const rm = document.getElementById('resultModal'); if(rm && rm.classList.contains('open')){ if(!rm.contains(e.target) && !e.target.closest('.thank-you')) rm.classList.remove('open'); } });

  // reset copy state when content changes or on paste (per requirement)
  contentEl.addEventListener('input', ()=> resetCopyState());
  contentEl.addEventListener('paste', ()=> setCopyActive(false));

  function setCopyActive(v){
    copyActive = !!v;
    if(copyActive){ copyUrlBtn.textContent='STELLARLY COPIED!'; copyUrlBtn.disabled = true; }
    else { copyUrlBtn.textContent = 'Copy URL'; copyUrlBtn.disabled = false; }
  }
  function resetCopyState(){ setCopyActive(false); }

}); // DOMContentLoaded end
</script>
</body>
</html>
